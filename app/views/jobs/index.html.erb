<% content_for :subnav_buttons do %>
<% end %>
<% content_for :subnav_pills do %>
    <%= link_to 'All', jobs_path(params: { all: 1 }), class: "btn" %>
<% end %>
<table class="table table-condensed table-striped tablesorter">
  <thead>
  <tr>
    <th style="width: 100px;">Status</th>
    <th style="width: 100px;">Class</th>
    <th>Message</th>
    <th class="links"></th>
  </tr>
  </thead>
  <tbody>
  <% @jobs.each do |job| %>
      <tr>
        <td><span class="<%= "text-error" if job.status == :error %>"><%= job.status %></span></td>
        <td><%= job.class.name %></td>
        <td><%= link_to((job.message||"none"), job_path(job)) %></td>
        <td class="links">
          <%= link_to "#", :title => "Refresh", :class => "btn btn-mini job_retry", "data-id" => job.id do %>
              <i class="icon-refresh"></i>
          <% end %>
          <% unless job.accepted_at %>
              <%= link_to job,
                          data:  {
                                  type: job.class.model_name.pluralize.downcase||"unknown",
                                  id:   job.id.to_s||"nil"
                          },
                          :title => "Accept",
                          :class => "btn btn-mini delete_me" do %>
                  <i class="icon-ok-sign"></i>
              <% end %>
          <% end %>
        </td>
      </tr>
  <% end %>
  </tbody>
</table>

<script>
  $(function(){
      $(".job_retry").on("click", function(){
          var id = $(this).attr("data-id");
          console.log("job "+id+" sending retry");
          $.post("/jobs/"+id+"/refresh.json", {}, function(){
              console.log("refresh sent");
          });
      });
  })
</script>

